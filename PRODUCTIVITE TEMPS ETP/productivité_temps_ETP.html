<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modèle de Productivité et ETP Multi-Agents</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .input-group { margin-bottom: 10px; }
        label { display: inline-block; width: 200px; }
        input { width: 100px; }
        #agentsList { margin-top: 20px; }
        .agent-item { margin-bottom: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        .chart-container { margin-top: 20px; }
        #equilibriumInfo { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Modèle de Productivité et ETP Multi-Agents</h1>
    
    <div class="input-group">
        <label for="duree">Durée (mois):</label>
        <input type="number" id="duree" value="120" step="1" min="1">
    </div>
    
    <h2>Ajouter un nouvel agent</h2>
    <div class="input-group">
        <label for="newAgentName">Nom de l'agent:</label>
        <input type="text" id="newAgentName" value="Agent">
    </div>
    <div class="input-group">
        <label for="newAgentC0">Compétence initiale (0-1):</label>
        <input type="number" id="newAgentC0" value="0.2" step="0.1" min="0" max="1">
    </div>
    <div class="input-group">
        <label for="newAgentR">Taux d'augmentation (0-1):</label>
        <input type="number" id="newAgentR" value="0.01" step="0.0001" min="0" max="1">
    </div>
    <div class="input-group">
        <label for="newAgentB">Facteur d'apprentissage (0-1):</label>
        <input type="number" id="newAgentB" value="0.5" step="0.1" min="0" max="1">
    </div>
    <button onclick="addAgent()">Ajouter l'agent</button>
    
    <div id="agentsList"></div>
    
    <button onclick="updateCharts()">Mettre à jour les graphiques</button>
    
    <div class="chart-container">
        <h3>Graphique de Productivité</h3>
        <canvas id="productivityChart"></canvas>
    </div>
    
    <div class="chart-container">
        <h3>Graphique d'ETP Productif</h3>
        <canvas id="etpChart"></canvas>
    </div>

    <div id="equilibriumInfo"></div>

    <script>
        let productivityChart, etpChart;
        let agents = [];

        function calculateProductivity(t, c0, r, b) {
            const competence = c0 + r * t;
            return 1 - Math.exp(-b * competence);
        }

        function addAgent() {
            const name = document.getElementById('newAgentName').value;
            const c0 = parseFloat(document.getElementById('newAgentC0').value);
            const r = parseFloat(document.getElementById('newAgentR').value);
            const b = parseFloat(document.getElementById('newAgentB').value);
            const color = getRandomColor();
            
            agents.push({ name, c0, r, b, color });
            updateAgentsList();
            updateCharts();
        }

        function updateAgentsList() {
            const list = document.getElementById('agentsList');
            list.innerHTML = '';
            agents.forEach((agent, index) => {
                list.innerHTML += `
                    <div class="agent-item" style="border-left: 5px solid ${agent.color}">
                        <strong>${agent.name}</strong>
                        <br>Compétence initiale: ${agent.c0}
                        <br>Taux d'augmentation: ${agent.r}
                        <br>Facteur d'apprentissage: ${agent.b}
                        <button onclick="removeAgent(${index})">Supprimer</button>
                    </div>
                `;
            });
        }

        function removeAgent(index) {
            agents.splice(index, 1);
            updateAgentsList();
            updateCharts();
        }

        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        function updateCharts() {
            const duree = parseInt(document.getElementById('duree').value);
            const labels = Array.from({length: duree}, (_, i) => i + 1);

            updateProductivityChart(labels);
            updateEtpChart(labels);
            updateEquilibriumInfo(duree);
        }

        function updateProductivityChart(labels) {
            const datasets = agents.map(agent => ({
                label: `${agent.name} - Productivité`,
                data: labels.map(t => calculateProductivity(t, agent.c0, agent.r, agent.b)),
                borderColor: agent.color,
                tension: 0.1
            }));

            if (productivityChart) {
                productivityChart.destroy();
            }

            const ctx = document.getElementById('productivityChart').getContext('2d');
            productivityChart = new Chart(ctx, {
                type: 'line',
                data: { labels, datasets },
                options: {
                    responsive: true,
                    scales: {
                        x: { title: { display: true, text: 'Mois' } },
                        y: { 
                            title: { display: true, text: 'Productivité' },
                            beginAtZero: true,
                            max: 1
                        }
                    }
                }
            });
        }

        function updateEtpChart(labels) {
            const datasets = agents.map(agent => ({
                label: `${agent.name} - ETP Productif`,
                data: labels.map(t => calculateProductivity(t, agent.c0, agent.r, agent.b)),
                borderColor: agent.color,
                tension: 0.1
            }));

            const totalEtpData = labels.map(t => {
                return agents.reduce((sum, agent) => sum + calculateProductivity(t, agent.c0, agent.r, agent.b), 0);
            });

            datasets.push({
                label: 'ETP Productif Total',
                data: totalEtpData,
                borderColor: 'rgb(0, 0, 0)',
                borderWidth: 3,
                tension: 0.1
            });

            if (etpChart) {
                etpChart.destroy();
            }

            const ctx = document.getElementById('etpChart').getContext('2d');
            etpChart = new Chart(ctx, {
                type: 'line',
                data: { labels, datasets },
                options: {
                    responsive: true,
                    scales: {
                        x: { title: { display: true, text: 'Mois' } },
                        y: { 
                            title: { display: true, text: 'ETP Productif' },
                            beginAtZero: true,
                            max: Math.max(agents.length, 1)
                        }
                    }
                }
            });
        }

        function updateEquilibriumInfo(duree) {
            const equilibriumInfo = document.getElementById('equilibriumInfo');
            let infoText = "<h3>Points d'équilibre ETP productif = ETP théorique</h3>";

            agents.forEach(agent => {
                const equilibriumMonth = calculateEquilibriumMonth(agent, duree);
                infoText += `<p><strong>${agent.name}</strong>: ${equilibriumMonth}</p>`;
            });

            const totalEquilibriumMonth = calculateTotalEquilibriumMonth(duree);
            infoText += `<p><strong>Équipe entière</strong>: ${totalEquilibriumMonth}</p>`;

            equilibriumInfo.innerHTML = infoText;
        }

        function calculateEquilibriumMonth(agent, maxMonths) {
            for (let t = 0; t <= maxMonths; t++) {
                if (calculateProductivity(t, agent.c0, agent.r, agent.b) >= 0.99) {
                    return `Mois ${t}`;
                }
            }
            return "Non atteint dans la période";
        }

        function calculateTotalEquilibriumMonth(maxMonths) {
            for (let t = 0; t <= maxMonths; t++) {
                const totalEtp = agents.reduce((sum, agent) => sum + calculateProductivity(t, agent.c0, agent.r, agent.b), 0);
                if (totalEtp >= agents.length * 0.99) {
                    return `Mois ${t}`;
                }
            }
            return "Non atteint dans la période";
        }

        document.addEventListener('DOMContentLoaded', updateCharts);
    </script>
</body>
</html>
